# ğŸ§± Tony - æç®€æ— æ¡†æ¶ Node.js Web æ–¹æ¡ˆ

> ä¸€ä¸ªæ— æ¡†æ¶ã€é«˜é€æ˜åº¦ã€æç®€ä¸»ä¹‰çš„ Node.js Web åº”ç”¨æ¶æ„ã€‚æ‹’ç»é­”æ³•ï¼Œæ‹’ç»å¤æ‚æ€§ï¼Œæ‹¥æŠ±æ¸…æ™°å’Œå¯æ§ã€‚

---

## ğŸš€ é¡¹ç›®ç†å¿µ

Tony ä¸ä¾èµ–ä»»ä½• Web æ¡†æ¶ï¼ˆå¦‚ Expressã€Koaã€Nestï¼‰ï¼Œä¹Ÿä¸ä½¿ç”¨è·¯ç”±åŒ¹é…å™¨ã€ä¸­é—´ä»¶é“¾æˆ– DI å®¹å™¨ã€‚

Tony çš„è®¾è®¡æ ¸å¿ƒæ˜¯ï¼š

- âœ… æ˜¾å¼é¡ºåºæ‰§è¡Œé€»è¾‘ï¼ˆä¸­é—´ä»¶å’Œè·¯ç”±ï¼‰
- âœ… æ¨¡å—åŒ–ç»„ç»‡ï¼Œä½†ä¸è‡ªåŠ¨åŠ è½½
- âœ… æ”¯æŒç±»ä¼¼ä¸­é—´ä»¶çš„åŠŸèƒ½æ§åˆ¶è¯·æ±‚æµç¨‹
- âœ… æ˜“è¯»ã€æ˜“è°ƒè¯•ã€æ— é»‘ç›’ã€å…¨å¯æ§
- âœ… æ”¯æŒç°ä»£ ES6 æ¨¡å—ä¸æ„å»ºï¼ˆé€šè¿‡ esbuildï¼‰

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ app.js                 # å…¥å£æ–‡ä»¶
â”œâ”€â”€ routers/               # è·¯ç”±å¤„ç†å™¨ï¼ˆæ¨¡å—åŒ–ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ _home.js
â”‚   â”œâ”€â”€ _api.js
â”‚   â””â”€â”€ _error.js
â”œâ”€â”€ middlewares/          # ä¸­é—´ä»¶ï¼ˆæ¨¡å—åŒ–ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ log.js
â”‚   â”œâ”€â”€ session.js
â”‚   â””â”€â”€ cookies.js
â””â”€â”€ public/               # å¯é€‰é™æ€èµ„æº
```

---

## ğŸ§¬ å·¥ä½œåŸç†

Tony ä½¿ç”¨æœ€åŸå§‹çš„ `http.createServer`ï¼Œä¸ä½¿ç”¨æ¡†æ¶ã€‚æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š

```js
// app.js
const { log, session } = require('./middlewares')
const { _home, _api } = require('./routers')

http.createServer(async (req, res) => {
  //middlewares
  await log(req, res)!
  await session(req, res)!
  //routers
  await home(req, res)!
  await api(req, res)!
})
```

ä¸­é—´ä»¶ä¸è·¯ç”±å‡½æ•°æ ¼å¼å¦‚ä¸‹ï¼š

```js
export default async function(req, res) {
  if (req.url === '/api/hello') {
    res.writeHead(200)
    res.end('Hello')
    return false // ä¸­æ–­åç»­æµç¨‹
  }
  return true // ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ¨¡å—
}
```

Tony ç‰¹æœ‰è¯­æ³•ç³–ï¼š`await fn(req, res)!` ç›¸å½“äºï¼š

```js
if (!await fn(req, res)) return;
```

å¯é€šè¿‡ esbuild æ’ä»¶æ”¯æŒè¯¥è¯­æ³•ç³–ã€‚

---

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### å¯åŠ¨æœåŠ¡

```bash
node app.js
```

æˆ–ä½¿ç”¨ esbuild æ‰“åŒ…æ”¯æŒè¯­æ³•ç³–ï¼š

```bash
esbuild app.js --bundle --outfile=dist/app.js --plugins=./tony-syntax-plugin.js
```

---

## ğŸŒŸ ç‰¹æ€§ä¸€è§ˆ

- âœ… é›¶æ¡†æ¶ï¼Œ0 ä¾èµ–ï¼ˆé™¤è‡ªé€‰åº“ï¼‰
- âœ… ç²¾å‡†ä¸­é—´ä»¶æ§åˆ¶ï¼ˆæ— é“¾å¼ä¸å¯æ§ç»“æ„ï¼‰
- âœ… è‡ªç”±æ¨¡å—ç»„ç»‡
- âœ… æ”¯æŒè‡ªå®šä¹‰è¯­æ³•ç³–ï¼ˆå¦‚ `await fn(req, res)!`ï¼‰
- âœ… æé«˜å¯è¯»æ€§ä¸è°ƒè¯•æ€§

---

## ğŸ’¡ ä¸ºä»€ä¹ˆé€‰æ‹© Tonyï¼Ÿ

| ä¼ ç»Ÿæ¡†æ¶é—®é¢˜        | Tony çš„è§£å†³æ–¹å¼           |
|---------------------|----------------------------|
| ä¸­é—´ä»¶é“¾è·¯ä¸å¯æ§    | æ˜¾å¼è°ƒç”¨ï¼Œé¡ºåºå®Œå…¨å¯æ§     |
| è‡ªåŠ¨æ‰«æéš¾è°ƒè¯•      | æ‰€æœ‰æ¨¡å—æ‰‹åŠ¨å¯¼å…¥ï¼Œé›¶é­”æ³•   |
| ä¾èµ–æ³¨å…¥å¤æ‚         | æ¨¡å—ç›´æ¥è°ƒç”¨ã€æ¸…æ™°å¼•ç”¨     |
| æ€§èƒ½éš¾ä»¥æŒæ§        | ç»“æ„æç®€ï¼Œæ— é»‘ç›’è´Ÿæ‹…       |

---

## ğŸ› ï¸ ä¸­é—´ä»¶å¼€å‘çº¦å®š

- æ¯ä¸ªä¸­é—´ä»¶æ˜¯ä¸€ä¸ª `async (req, res)` å‡½æ•°
- è¿”å› `false` è¡¨ç¤ºç»ˆç»“è¯·æ±‚
- è¿”å› `true` è¡¨ç¤ºç»§ç»­æµç¨‹
- å¯æ‰©å±• `req.xxx`ã€`res.xxx`

---

## ğŸ§© TODO / å»ºè®®æ‰©å±•

- [ ] è‡ªå®šä¹‰ 404 / 500 å“åº”å¤„ç†å™¨
- [ ] é™æ€èµ„æºæœåŠ¡æ¨¡å—ï¼ˆmiddlewares/static.jsï¼‰
- [ ] esbuild è¯­æ³•ç³–æ’ä»¶æ¨¡æ¿
- [ ] CLI è„šæ‰‹æ¶å·¥å…·

---

## ğŸ“„ License

MIT